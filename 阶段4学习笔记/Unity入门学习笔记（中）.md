## 学习背景

* 制作**[Ruby's Adventure](https://www.sikiedu.com/my/course/650)**，过程中注意学习以下内容

1. 了解unity工程面板
2. 组件的概念与理解
3. 物体的物理系统
4. 动画系统，粒子系统，Cinemachine工具包
5. 敌人AI的制作
6. UGUI
7. 完整游戏流程梳理

## 目录

物理系统

道具制作

敌人制作

动画制作

子弹制作

## 学习内容

### 1.unity物理系统

unity自带模拟现实世界的物理效果的物理系统，只需在精灵的inspector界面中添加就可以使用。

**刚体组件（Rigidbody）**：使游戏物体能获得重力，接受外界的受力和扭力功能的组件，可以通过脚本或是物理引擎为游戏对象添加刚体组件。（2d俯视角游戏一般不需要重力）

**碰撞器组件（BoxCollider）**:使游戏物体具有跟挂载刚体组件的游戏物体发生碰撞能力的组件。

发生碰撞检测的**必要**条件：双方必须都有碰撞器，且一方有刚体，最好是运动的一方。因为Unity为了性能的优化，刚体长时间不发生碰撞检测会休眠。

2D游戏物体因为碰撞受力会发生Z轴上的角度旋转，可以通过`Rigidbody2D>Constraints>FreezeRotation`去冻结Z轴上的角度旋转。

可以给Tilemap游戏地形上添加碰撞器，这样可以制作一些禁止通过的地形：

在Tilemap游戏物体上添加Tilemap Collider 2D组件，将不需要添加碰撞器的瓦片资源选中，将Collider Type从Sprite改为None。

###  2.道具制作

c#中存在三种常用的访问修饰符：

* public（公有的） ：任何代码均可以访问，应用于所有类或成员。

* protected（受保护的） ：只能在当前类或其派生类中使用，应用于内嵌类或成员。

* private（私有的） ：只能在当前类中使用，应用于内嵌类或成员。

它们限制了可以访问对应变量和方法的对象。



勾选`BoxCollider`组件下的`isTrigger`属性,可以把碰撞器做成触发器,用于道具的触发检测。（也可以用于制作陷阱）                                                                                                           触发条件同碰撞器

道具被触发（即拾取使用）后，用`Destory()`方法销毁对象。

### 3.敌人制作

导入敌人素材，配上碰撞箱，设置水平和垂直移动

![chmove](https://raw.githubusercontent.com/chlorine22/Tasks/main/阶段4学习笔记/图片素材/chmove.png)

当然也要设置碰撞检测，以及对主角造成伤害。

![hit](https://raw.githubusercontent.com/chlorine22/Tasks/main/阶段4学习笔记/图片素材/hit.png)

### 4.动画制作

**动画制作组件（Animator）**：为了完成游戏对象动态效果的控制和创建，Unity为我们提供的一个动画设计解决方案，同时也是一个组件。

**动画控制器（Animator Controller）**：根据当前游戏对象的状态控制播放对应的游戏动画。也可以叫做动画状态机。

**动画（Animation）**：Unity中的动画资源，可以由动画控制器，代码去进行播放，也是一种组件。

选中对应游戏物体打开动画面板，在动画面板中可以创建新的动画，第一次动画可直接创建，后续需要在动画名称上点击，在下拉菜单中点击CreateNewClip创建。也可以在Project面板里右键进行创建。

创建动画后可以给动画添加该游戏物体上的所有组件所持有的属性改变的相应动画，点击Preview可以预览动画效果，点击右边红色圆点按钮可以进行录制操作，在Inpector里属性的改变会直接将关键帧添加在时间轴上，也可以右键在时间轴上添加关键帧。

将若干个图片拖拽进动画窗口可自动添加制作成一个关键帧动画。可全选待鼠标变为双向箭头进行等比拉伸，延长动画时间，变慢动画速度。

如果没有对应动画的图片资源，可以借由改变SpriteRenderer中的Flip属性去翻转动画。

将动画拖拽进动画控制器窗口中可以添加动画状态。

Parameters列表里可以添加配置参数，参数可用于设置动画过渡的条件。右键动画状态可设置默认动画以及添加过渡条件。选中过渡条件连线可在Inpector面板中Conditions去设置参数条件。

 在代码中获取Animator组件之后可以使用set+变量类型的方法去设置状态机里的参数值。

如果想要让上一个动画瞬间过渡到下一个动画，需要把条件中的`HasExitTime`取消勾选，让动画没有退出时间，而是可以瞬间退出。且需要把`TransitionDuration`过渡时间间隔设置为0。

**转换(Transition)**

用于在给定时间量内从一个动画状态 (Animation State) 平滑转换为另一个状态。转换指定为动画状态机 (Animation State Machine) 的一部分。如果转换迅速，则通常可从一个运动很好地转换为完全不同的运动。

**混合树(Blend Tree)**

用于允许通过按不同程度组合所有动画的各个部分来平滑混合多个动画。各个运动参与形成最终效果的量使用混合参数进行控制，该参数只是与动画器控制器关联的数值动画参数之一。要使混合运动有意义，混合的运动必须具有相似性质和时间。混合树是动画器控制器中的特殊状态类型。

 Vector类型的变量既可以用来表示坐标，也可以用来表示向量。

 `Mathf.Approximately(a,b)`可以用来判断两个浮点数a,b之间是否近似相等。

 `a.Normalize()`方法可以用来使向量a单位化。`a.magnitude`是可以取到当前a的向量模长。

### 5.子弹制作

ruby发射子弹，即ruby给子弹一个初速度。

通过物理系统给游戏对象施加力的效果，需要先获取到刚体组件，然后调用`AddForce()`方法。

**实例化（Instantiate）**

如果想要动态生成一个游戏物体，需要调用实例化方法来对预制体进行克隆。

第一个参数是想要克隆的预制体资源，第二个参数是需要生成到的位置，第三个参数是旋转角度。旋转角度跟检视面板里显示的是不一样的，是一个四元数类型的参数，**不是**Vector3类型的参数。

**Awake方法先于Start方法调用**，都是Unity内置封装的方法，跟Update方法一样，统称为生命周期函数。Awake方法会在游戏物体实例化（生成）时就调用，Start方法不会。

通过`Edit > Project Settings > Physics 2D`来设置各个层级的碰撞检测

可以在`inspector`右上角设置物体层级，以进行分层

















